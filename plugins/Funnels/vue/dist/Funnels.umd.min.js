(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("Goals"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome","Goals",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["Funnels"]=t(require("CoreHome"),require("Goals"),require("vue"),require("CorePluginsAdmin")):e["Funnels"]=t(e["CoreHome"],e["Goals"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,n,l){return function(e){var t={};function n(l){if(t[l])return t[l].exports;var o=t[l]={i:l,l:!1,exports:{}};return e[l].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,l){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(l,o,function(t){return e[t]}.bind(null,o));return l},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/Funnels/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"6ec9":function(e,t){function n(e){return e?e.toLocaleString():"0"}function l(e){return e?e>=9995e4?Math.round(e/1e6)+"m":e>=999500?(Math.round(e/1e5)/10).toFixed(1)+"m":e>=99950?Math.round(e/1e3)+"k":e>=1e3?(Math.round(e/100)/10).toFixed(1)+"k":e.toString():"0"}e.exports={formatNumber:n,formatAbbr:l}},"76d2":function(e,n){e.exports=t},"8bbf":function(e,t){e.exports=n},a5a2:function(e,t){e.exports=l},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"ManageFunnel",(function(){return J})),n.d(t,"SalesFunnel",(function(){return ae})),n.d(t,"FunnelPageLink",(function(){return re})),n.d(t,"FunnelSummary",(function(){return fe})),n.d(t,"GoalFunnelReport",(function(){return jt})),n.d(t,"ManageSiteFunnels",(function(){return zt})),n.d(t,"FunnelConversionReport",(function(){return Jn})),"undefined"!==typeof window){var l=window.document.currentScript,o=l&&l.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(n.p=o[1])}var a=n("8bbf");const s={class:"alert alert-info"},i=Object(a["createElementVNode"])("br",null,null,-1),r=["value"],c={class:"activateFunnel"},d={class:"manageFunnel"},u={class:"stepHeading"},p={class:"funnelsTable",ref:"funnelsTable"},b=["title"],m=["title"],O={class:"stepName"},j={class:"stepPattern"},h={class:"stepRequired"},g=["title","onClick"],v=["title","onClick"],f={key:0,class:"step inactive"},F={class:"stepName"},E=Object(a["createElementVNode"])("td",null,null,-1),N=Object(a["createElementVNode"])("td",null,null,-1),k=Object(a["createElementVNode"])("td",null,null,-1),V={class:"stepRequired"},y=Object(a["createElementVNode"])("td",null,null,-1),S=Object(a["createElementVNode"])("td",null,null,-1),_=Object(a["createElementVNode"])("div",{id:"funnelValidationError"},null,-1),w={class:"tableActionBar"},B=Object(a["createElementVNode"])("span",{class:"icon-add"},null,-1),C={class:"targetValidator"},T={class:"urlField"},x={class:"loadingPiwik loadingMatchingSteps"},L=Object(a["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif",alt:""},null,-1),M={class:"ui-confirm",ref:"infoFunnelIsLocked"},D=["value"],G=["value"],R={class:"ui-confirm",ref:"cannotActivateIncompleteSteps"},U=["value"],H={class:"ui-confirm",ref:"confirmUnlockFunnel"},A=["value"],q=["value"],P={class:"ui-confirm",ref:"confirmDeactivateFunnel"},I=["value"],$=["value"];function z(e,t,n,l,o,z){const W=Object(a["resolveComponent"])("Field"),Y=Object(a["resolveComponent"])("ActivityIndicator"),X=Object(a["resolveDirective"])("content-table");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["withDirectives"])(Object(a["createElementVNode"])("div",s,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_WarningFunnelIsActivatedRequiredUnlock"))+" ",1),i,Object(a["createElementVNode"])("input",{type:"button",class:"btn unlockFunnel",onClick:t[0]||(t[0]=t=>e.unlockFunnel()),value:e.translate("Funnels_Unlock")},null,8,r)],512),[[a["vShow"],e.isLocked]]),Object(a["createElementVNode"])("div",c,[e.isHideEnable?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createBlock"])(W,{key:0,uicontrol:"checkbox",name:"activateFunnel","model-value":e.funnel.activated,"onUpdate:modelValue":t[1]||(t[1]=t=>e.toggleFunnelActivated(t)),"model-modifiers":{abortable:!0},title:e.translate("Funnels_EnableFunnel"),"inline-help":e.getEnableFunnelHelpText,disabled:e.isLocked},null,8,["model-value","title","inline-help","disabled"]))]),Object(a["createVNode"])(Y,{loading:e.isLoading},null,8,["loading"]),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",d,[Object(a["withDirectives"])(Object(a["createElementVNode"])("div",{class:"alert alert-warning"},Object(a["toDisplayString"])(e.translate("Funnels_WarningOnUpdateReportNeedsArchiving")),513),[[a["vShow"],e.isUnlocked]]),Object(a["createElementVNode"])("h3",u,Object(a["toDisplayString"])(e.translate("Funnels_Steps")),1),Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createElementBlock"])("table",p,[Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Funnels_Step")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("General_Name")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Funnels_ComparisonColumnTitle")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Funnels_Condition")),1),Object(a["createElementVNode"])("th",null,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Goals_Pattern"))+" ",1),Object(a["createElementVNode"])("span",{class:"icon-info header-help",title:e.translate("Funnels_PatternHelpText")},null,8,b)]),Object(a["createElementVNode"])("th",null,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_RequiredColumnTitle"))+" ",1),Object(a["createElementVNode"])("span",{class:"icon-info header-help required-help-icon",title:e.getRequiredHelpText},null,8,m)]),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("General_Help")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("General_Remove")),1)])]),Object(a["createElementVNode"])("tbody",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.funnel.steps,(t,n)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",{class:Object(a["normalizeClass"])(`step step${n+1} ${e.matches[n]} ${e.isLocked?"inactive":""}`),key:n},[Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(n+1),1),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",O,[Object(a["createVNode"])(W,{uicontrol:"text",placeholder:e.translate("Funnels_StepName"),name:"stepName"+(n+1),modelValue:t.name,"onUpdate:modelValue":e=>t.name=e,maxlength:150,"full-width":!0,disabled:e.isLocked},null,8,["placeholder","name","modelValue","onUpdate:modelValue","disabled"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",null,[Object(a["createVNode"])(W,{uicontrol:"select",name:"patternComparison","model-value":t.patternComparison,"onUpdate:modelValue":l=>{e.updatePatternType(t.patternComparison,l,n),t.patternComparison=l,e.validateSteps()},disabled:e.isLocked,"full-width":!0,options:e.patterns},null,8,["model-value","onUpdate:modelValue","disabled","options"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",null,[Object(a["createVNode"])(W,{uicontrol:"select",name:"pattern_type","model-value":t.pattern_type,"onUpdate:modelValue":n=>{t.pattern_type=n,e.validateSteps()},disabled:e.isLocked,"full-width":!0,options:e.patternConditions(t.patternComparison)},null,8,["model-value","onUpdate:modelValue","disabled","options"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",j,[Object(a["createVNode"])(W,{uicontrol:"text","model-value":t.pattern,"onUpdate:modelValue":n=>{t.pattern=n,e.validateSteps()},name:`stepPattern${n}1`,maxlength:1e3,"full-width":!0,disabled:e.isLocked,placeholder:e.patternExamples[t.pattern_type],hidden:"goal"===t.patternComparison},null,8,["model-value","onUpdate:modelValue","name","disabled","placeholder","hidden"]),Object(a["createVNode"])(W,{uicontrol:"select",name:`stepPattern${n}1`,options:e.goals,"model-value":t.pattern,"onUpdate:modelValue":n=>{t.pattern=n,e.validateSteps()},disabled:e.isLocked,hidden:"goal"!==t.patternComparison,"full-width":!0},null,8,["name","options","model-value","onUpdate:modelValue","disabled","hidden"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",h,[Object(a["createVNode"])(W,{uicontrol:"checkbox",name:`stepRequired${n}1`,modelValue:t.required,"onUpdate:modelValue":e=>t.required=e,disabled:e.isLocked},null,8,["name","modelValue","onUpdate:modelValue","disabled"])])]),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])(["icon-info table-action",{helpHidden:"goal"===t.patternComparison}]),title:e.translate("Funnels_HelpStepTooltip"),onClick:t=>e.showHelpForStep(n)},null,10,g)]),Object(a["createElementVNode"])("td",null,[Object(a["withDirectives"])(Object(a["createElementVNode"])("span",{class:"icon-minus table-action",title:e.translate("Funnels_RemoveStepTooltip"),onClick:t=>e.removeStep(n)},null,8,v),[[a["vShow"],e.funnel.steps.length>1]])])],2))),128)),!e.isNonGoalFunnel||e.isSalesFunnel?(Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",f,[Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(e.funnel.steps.length+1),1),Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",F,[Object(a["createVNode"])(W,{uicontrol:"text",modelValue:e.getGoalName,"onUpdate:modelValue":t[2]||(t[2]=t=>e.getGoalName=t),"full-width":!0,disabled:!0},null,8,["modelValue"])])]),E,N,k,Object(a["createElementVNode"])("td",null,[Object(a["createElementVNode"])("div",V,[Object(a["createVNode"])(W,{uicontrol:"checkbox",modelValue:e.isGoalRequired,"onUpdate:modelValue":t[3]||(t[3]=t=>e.isGoalRequired=t),disabled:!0},null,8,["modelValue"])])]),y,S])):Object(a["createCommentVNode"])("",!0)])])),[[a["vShow"],!e.isLoading],[X]]),_,Object(a["withDirectives"])(Object(a["createElementVNode"])("div",w,[Object(a["createElementVNode"])("button",{class:"addNewStep",onClick:t[4]||(t[4]=t=>e.addStep())},[B,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_AddStep")),1)])],512),[[a["vShow"],!e.isLoading]]),Object(a["createElementVNode"])("div",C,[Object(a["createElementVNode"])("div",T,[Object(a["createVNode"])(W,{uicontrol:"text",name:"urlField",title:e.translate("Funnels_ValidateStepsOptional"),placeholder:"https://www.example.com","model-value":e.validateUrl,"onUpdate:modelValue":t[5]||(t[5]=t=>{e.validateUrl=t,e.validateSteps()}),onClick:t[6]||(t[6]=t=>e.prefillValidateUrl()),"inline-help":e.getTestUrlHelpText},null,8,["title","model-value","inline-help"])]),Object(a["withDirectives"])(Object(a["createElementVNode"])("span",x,[L,Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("General_LoadingData")),1)],512),[[a["vShow"],e.isLoadingMatchingSteps]])]),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",{class:"alert alert-warning"},Object(a["toDisplayString"])(e.translate("Funnels_WarningOnUpdateReportNeedsArchiving")),513),[[a["vShow"],e.isUnlocked]]),Object(a["createElementVNode"])("div",M,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_InfoFunnelIsLocked")),1),Object(a["createElementVNode"])("input",{role:"unlock",type:"button",value:e.translate("Funnels_Unlock")},null,8,D),Object(a["createElementVNode"])("input",{role:"ok",type:"button",value:e.translate("General_Cancel")},null,8,G)],512),Object(a["createElementVNode"])("div",R,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_InfoCannotActivateFunnelIncomplete")),1),Object(a["createElementVNode"])("input",{role:"ok",type:"button",value:e.translate("General_Ok")},null,8,U)],512),Object(a["createElementVNode"])("div",H,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_ConfirmUnlockFunnel")),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,A),Object(a["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,q)],512),Object(a["createElementVNode"])("div",P,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_ConfirmDeactivateFunnel")),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,I),Object(a["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,$)],512)],512),[[a["vShow"],e.funnel.activated]])],64)}var W=n("19dc"),Y=n("a5a2"),X=n("76d2"),K=Object(a["defineComponent"])({props:{showGoal:Number,isHideEnable:{type:Boolean,default:!1},isSalesFunnel:{type:Boolean,default:!1},isNonGoalFunnel:{type:Boolean,default:!1},goals:{type:Array,required:!0}},components:{ActivityIndicator:W["ActivityIndicator"],Field:Y["Field"]},directives:{ContentTable:W["ContentTable"]},data(){return{funnel:{},isLoading:!1,patternMatchOptions:[],isLocked:!1,isUnlocked:!1,matches:{},validateUrl:"",isLoadingMatchingSteps:!1,isGoalRequired:!0}},created(){this.fetchMatchingSteps=Object(W["debounce"])(this.fetchMatchingSteps,200);const e=X["ManageGoalsStore"].idGoal.value||this.showGoal;this.isNonGoalFunnel&&!this.isSalesFunnel||"number"!==typeof e||this.initGoalForm("Goals.updateGoal",e,""),W["AjaxHelper"].fetch({method:"Funnels.getAvailablePatternMatches"}).then(e=>{this.patternMatchOptions=e}),this.reset(),this.isSalesFunnel&&W["Matomo"].on("Funnels.beforeUpdateSalesFunnel",this.onSetFunnel),this.isNonGoalFunnel&&!this.isSalesFunnel&&(W["Matomo"].on("Funnels.resetForm",()=>this.resetForm()),W["Matomo"].on("Funnels.initFunnelForm",this.initFunnelForm.bind(this)),W["Matomo"].on("Funnels.beforeUpdateFunnel",this.onSetFunnel)),this.isNonGoalFunnel||(W["Matomo"].on("Goals.beforeInitGoalForm",this.initGoalForm.bind(this)),W["Matomo"].on("Goals.beforeAddGoal",this.onSetFunnel.bind(this)),W["Matomo"].on("Goals.beforeUpdateGoal",this.onSetFunnel.bind(this)),W["Matomo"].on("Goals.cancelForm",()=>this.resetForm()),W["Matomo"].on("Goals.goalNameChanged",this.updateGoalName.bind(this)))},updated(){this.$nextTick(()=>{this.isSalesFunnel?setTimeout(()=>{this.scrollToFunnelsTable()},1e3):this.scrollToFunnelsTable()})},unmounted(){this.isSalesFunnel&&W["Matomo"].off("Funnels.beforeUpdateSalesFunnel",this.onSetFunnel),this.isNonGoalFunnel&&!this.isSalesFunnel&&W["Matomo"].off("Funnels.beforeUpdateFunnel",this.onSetFunnel)},methods:{testUrlMatchesSteps:W["AjaxHelper"].oneAtATime("Funnels.testUrlMatchesSteps",{errorElement:"#funnelValidationError"}),getGoalFunnel:W["AjaxHelper"].oneAtATime("Funnels.getGoalFunnel"),getFunnel:W["AjaxHelper"].oneAtATime("Funnels.getFunnel"),doUnlock(){this.isLocked=!1,this.isUnlocked=!0},confirmFunnelIsLocked(){return new Promise(e=>{W["Matomo"].helper.modalConfirm(this.$refs.infoFunnelIsLocked,{unlock:()=>{this.doUnlock(),e()}})})},addStep(){var e;this.funnel&&(this.isLocked?this.confirmFunnelIsLocked().then(()=>{this.addStep()}):(null!==(e=this.funnel.steps)&&void 0!==e&&e.length||(this.funnel.steps=[]),this.funnel.steps=[...this.funnel.steps,{name:"",pattern:"",pattern_type:"path_equals",patternComparison:"path",required:!0}]))},removeStep(e){var t;if(this.funnel)if(this.isLocked)this.confirmFunnelIsLocked().then(()=>{this.removeStep(e)});else{if(e>-1&&null!==(t=this.funnel)&&void 0!==t&&t.steps){this.removeTooltipForStep(e+1);const t=[...this.funnel.steps];t.splice(e,1),this.funnel.steps=t}this.validateSteps()}},removeTooltipForStep(e){const t=`table.funnelsTable tr.step${e} span.icon-minus`,n=document.querySelectorAll(t)[0],l=n.getAttribute("aria-describedby");if(!l)return;const o=document.getElementById(l);o&&o.remove()},prefillValidateUrl(){this.validateUrl||(this.validateUrl="https://www.")},fetchMatchingSteps(){var e;const t=this.validateUrl;t&&null!==(e=this.funnel)&&void 0!==e&&null!==(e=e.steps)&&void 0!==e&&e.length&&this.stepsWithPattern.length&&(this.isLoadingMatchingSteps=!0,this.testUrlMatchesSteps({url:t},{steps:this.stepsWithPattern}).then(e=>{var t;null!==(t=this.funnel)&&void 0!==t&&t.steps&&null!==e&&void 0!==e&&e.url&&null!==e&&void 0!==e&&e.tests&&e.url===this.validateUrl&&this.funnel.steps.forEach((t,n)=>{e.tests.forEach(e=>{e&&t.pattern===e.pattern&&t.pattern_type===e.pattern_type&&(this.matches[n]=e.matches?"validateMatch":"validateMismatch")})})}).finally(()=>{this.isLoadingMatchingSteps=!1}))},cannotActivateIncompleteSteps(){W["Matomo"].helper.modalConfirm(this.$refs.cannotActivateIncompleteSteps,{})},validateSteps(){var e;this.matches={1:""},null!==(e=this.funnel.steps)&&void 0!==e&&e.length&&(this.matches=this.funnel.steps.map(()=>"noValidation"),this.validateUrl&&this.fetchMatchingSteps())},updatePatternType(e,t,n){const l=this.patternConditions(t),o=Object.keys(l)[0];if(this.funnel.steps[n].pattern_type=o,"goal"===t&&this.funnel.steps[n].patternComparison===e){const e=this.goals[0];this.funnel.steps[n].pattern=e.key}else this.funnel.steps[n].pattern=""},unlockFunnel(){this.funnel&&this.isLocked&&W["Matomo"].helper.modalConfirm(this.$refs.confirmUnlockFunnel,{yes:()=>{this.doUnlock()}})},toggleFunnelActivated(e){if(this.funnel)return this.isLocked&&e?(e.abort(),void this.confirmFunnelIsLocked().then(()=>{this.toggleFunnelActivated(e)})):void(this.funnel.activated?W["Matomo"].helper.modalConfirm(this.$refs.confirmDeactivateFunnel,{yes:()=>{this.funnel.activated=!1},no:()=>{e.abort(),this.funnel.activated=!0}}):this.funnel.activated=!0)},showHelpForStep(e){var t;const n=null===(t=this.funnel)||void 0===t||null===(t=t.steps)||void 0===t?void 0:t[e],l=(null===n||void 0===n?void 0:n.pattern)&&(null===n||void 0===n?void 0:n.pattern_type),o=W["MatomoUrl"].stringify({module:"Funnels",action:"stepHelp",pattern:l?n.pattern:void 0,pattern_type:l?n.pattern_type:void 0}),a=Object(W["translate"])("General_Help");Piwik_Popover.createPopupAndLoadUrl(o,a,"funnelStepHelp")},reset(e=!1){this.funnel={activated:this.isNonGoalFunnel,steps:[]},this.isLocked=!1,this.isUnlocked=!1,this.matches={1:""},this.validateUrl="",e||this.addStep()},resetForm(e=!1){this.reset(e),this.isLoading=!1},initGoalForm(e,t,n){this.resetForm(),""!==t&&"Goals.addGoal"!==e&&(this.isLoading=!0,this.getGoalFunnel({idGoal:t}).then(e=>{e&&(this.funnel=e,this.funnel.name=this.funnel.name?this.funnel.name:n,this.funnel.steps||(this.funnel.steps=[],this.addStep()),this.funnel.activated?this.isLocked=!0:this.isLocked=!1,this.isNonGoalFunnel&&"undefined"===typeof this.funnel.idfunnel&&(this.funnel.activated=!0),this.validateSteps())}).finally(()=>{this.isLoading=!1}))},initFunnelForm(e,t){this.resetForm(t>0),0!==t&&(this.isLoading=!0,setTimeout(()=>{this.getFunnel({idSite:e,idFunnel:t}).then(e=>{e&&(this.funnel=e,this.funnel.steps||(this.funnel.steps=[],this.addStep()),this.funnel.activated?this.isLocked=!0:this.isLocked=!1,this.validateSteps())}).finally(()=>{this.isLoading=!1})},500))},onSetFunnel({parameters:e,options:t}){var n;if(!this.funnel||this.isLocked&&(this.isSalesFunnel||this.isNonGoalFunnel))return e.isLocked=this.isLocked,void(e.cancelRequest=!0);if(this.funnel.activated&&(null===(n=this.funnel.steps)||void 0===n||!n.length))return this.cannotActivateIncompleteSteps(),void(e.cancelRequest=!0);const l=this.funnel.steps.some(e=>this.isStepIncomplete(e));if(this.funnel.activated&&l)return this.cannotActivateIncompleteSteps(),void(e.cancelRequest=!0);t.postParams=Object.assign(Object.assign({},t.postParams),{},{funnelSteps:this.stepsWithNameAndPattern,funnelActivated:this.funnel.activated?"1":"0"}),this.isNonGoalFunnel&&(t.postParams=Object.assign(Object.assign({},t.postParams),{},{steps:this.stepsWithNameAndPattern,isActivated:this.funnel.activated?"1":"0"}),!this.isSalesFunnel&&t.postParams.steps.length&&(t.postParams.steps[t.postParams.steps.length-1].required=1))},isStepIncomplete(e){return!e.name||!e.name.trim()||!e.pattern||!e.pattern.trim()},updateGoalName(e){this.funnel.name=e},scrollToFunnelsTable(){const e=this.$refs.funnelsTable,t=Object.assign({},W["MatomoUrl"].hashParsed.value);t.scrollToFunnel&&e&&(delete t.scrollToFunnel,e.scrollIntoView())},patternConditions(e){const t={};return Object.entries(this.patternMatchOptions).forEach(([n,l])=>{n===e&&Object.values(l.conditions).forEach(e=>{t[e.key]=e.value})}),t}},computed:{patternExamples(){const e={};return Object.values(this.patternMatchOptions).forEach(t=>{Object.values(t.conditions).forEach(t=>{e[t.key]=t.example})}),e},patterns(){const e={};return Object.entries(this.patternMatchOptions).forEach(([t,n])=>{e[t]=n.comparisonName}),e},stepsWithPattern(){var e;return null!==(e=this.funnel.steps)&&void 0!==e&&e.length?this.funnel.steps.filter(e=>e&&e.pattern&&e.pattern_type).map(e=>Object.assign(Object.assign({},e),{},{required:e.required?1:0})):[]},stepsWithNameAndPattern(){let e=this.stepsWithPattern;return e=e.filter(e=>e.name),e},getEnableFunnelHelpText(){const e='<a target="_blank" rel="noreferrer noopener" href="https://matomo.org/faq/funnels/faq_22793/">';return Object(W["translate"])("Funnels_EnableFunnelHelpText",e,"</a>")},getGoalName(){return this.isSalesFunnel?Object(W["translate"])("Ecommerce_Sales"):this.funnel.name?this.funnel.name:Object(W["translate"])("Goals_GoalName")},getTestUrlHelpText(){const e=Object(W["translate"])("Funnels_TestUrlHelpText"),t=Object(W["translate"])("Funnels_TestUrlHelpTextGoalComparison","<i>","</i>");return`${e} ${t}`},getRequiredHelpText(){const e=Object(W["translate"])("Funnels_RequiredStepsHelpTextNote","<br><br><strong>","</strong>");return Object(W["translate"])("Funnels_RequiredStepsHelpTextNew")+e}}});K.render=z;var J=K;const Q=Object(a["createElementVNode"])("span",{class:"icon-show"},null,-1),Z=Object(a["createElementVNode"])("br",null,null,-1),ee=Object(a["createElementVNode"])("br",null,null,-1),te={class:"ui-confirm",ref:"funnelIsLockedCannotBeSaved"},ne=["value"];function le(e,t,n,l,o,s){const i=Object(a["resolveComponent"])("SaveButton"),r=Object(a["resolveComponent"])("ManageFunnel");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",null,[Object(a["createVNode"])(i,{class:"toggleEditSalesFunnel",value:e.translate("Funnels_EditSalesFunnel"),disabled:e.showEditForm,onConfirm:t[0]||(t[0]=t=>e.showEditForm=!e.showEditForm),saving:e.isLoading},null,8,["value","disabled","saving"]),e.idFunnel?(Object(a["openBlock"])(),Object(a["createElementBlock"])("a",{key:0,class:"btn",onClick:t[1]||(t[1]=Object(a["withModifiers"])(t=>e.openFunnelReport(e.idFunnel),["prevent"])),style:{"margin-left":"3.5px"}},[Q,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_ViewSalesFunnelReport")),1)])):Object(a["createCommentVNode"])("",!0),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",null,[Z,ee,Object(a["createVNode"])(r,{"show-goal":0,"is-sales-funnel":!0,"is-non-goal-funnel":!0,goals:e.goals},null,8,["goals"]),Object(a["createVNode"])(i,{class:"saveSalesFunnel",onConfirm:t[2]||(t[2]=t=>e.save()),saving:e.isLoading},null,8,["saving"]),Object(a["createElementVNode"])("div",te,[Object(a["createElementVNode"])("h3",null,Object(a["toDisplayString"])(e.translate("Funnels_FunnelIsLockedCannotBeSaved")),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Ok")},null,8,ne)],512)],512),[[a["vShow"],e.showEditForm]])])}var oe=Object(a["defineComponent"])({props:{idFunnel:{type:[String,Number],required:!1,default:0},isFunnelEdit:{type:Boolean,required:!1,default:!1},goals:{type:Array,required:!0}},components:{SaveButton:Y["SaveButton"],ManageFunnel:J},data(){return{isLoading:!1,showEditForm:!1}},methods:{openFunnelReport(e){W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Funnels_Funnels",subcategory:e}))},save(){const e={method:"Funnels.setGoalFunnel",idGoal:"0"},t={};W["Matomo"].postEvent("Funnels.beforeUpdateSalesFunnel",{parameters:e,options:t}),e&&e.isLocked&&this.$refs.funnelIsLockedCannotBeSaved?W["Matomo"].helper.modalConfirm(this.$refs.funnelIsLockedCannotBeSaved,{}):e.cancelRequest||(this.isLoading=!0,W["AjaxHelper"].fetch(e,t).then(()=>{window.location.reload()}).catch(()=>{this.isLoading=!1}))}},mounted(){this.isFunnelEdit&&(this.showEditForm=!0)}});oe.render=le;var ae=oe;
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */const{$:se}=window,ie={mounted(e,t){if(!W["Matomo"].helper.isReportingPage())return;let n=se(e);if("a"!==e.tagName.toLowerCase()){const t=se(e).text();se(e).html("<a></a>"),n=se(e).find("a"),n.text(t)}n.bind("click",e=>{e.preventDefault(),W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Funnels_Funnels",subcategory:t.value.idFunnel}))})}};var re=ie;W["Matomo"].on("Matomo.processDynamicHtml",e=>{e.find("[piwik-funnel-page-link]").each((e,t)=>{if(se(t).attr("piwik-funnel-page-link-handled"))return;const n=se(t).attr("piwik-funnel-page-link");n&&ie.mounted(t,{instance:null,value:{idFunnel:n},oldValue:null,modifiers:{},dir:{}}),se(t).attr("piwik-funnel-page-link-handled","1")})});const ce={class:"funnelsReport"},de={class:"funnelSummary"},ue={key:0},pe=Object(a["createElementVNode"])("span",{class:"icon-visitor-profile funnelOverviewLink"},null,-1),be={key:1},me=Object(a["createElementVNode"])("span",{class:"icon-reporting-goal funnelOverviewLink"},null,-1),Oe={key:2},je=Object(a["createElementVNode"])("span",{class:"icon-edit funnelOverviewLink"},null,-1);function he(e,t,n,l,o,s){const i=Object(a["resolveComponent"])("ContentBlock");return Object(a["openBlock"])(),Object(a["createBlock"])(i,{"content-title":e.$sanitize(e.funnel.name)},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",ce,[Object(a["createElementVNode"])("div",de,[e.isVisitorLogEnabled?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",ue,[Object(a["createElementVNode"])("a",{class:"funnelOverviewLink",onClick:t[0]||(t[0]=Object(a["withModifiers"])(t=>e.openSegmentedVisitorLog(),["prevent"]))},[pe,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_ShowFunnelVisitsLog")),1)])])):Object(a["createCommentVNode"])("",!0),e.funnel.idgoal>0?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",be,[Object(a["createElementVNode"])("a",{class:"funnelOverviewLink",onClick:t[1]||(t[1]=Object(a["withModifiers"])(t=>e.openGoalReport(),["prevent"]))},[me,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_ShowGoalReport")),1)])])):Object(a["createCommentVNode"])("",!0),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Oe,[Object(a["createElementVNode"])("a",{onClick:t[2]||(t[2]=Object(a["withModifiers"])(t=>e.editFunnel(),["prevent"])),class:"funnelOverviewLink"},[je,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_EditFunnel")),1)])])):Object(a["createCommentVNode"])("",!0)])])]),_:1},8,["content-title"])}const{SegmentedVisitorLog:ge}=window;var ve=Object(a["defineComponent"])({props:{funnel:{type:Object,required:!0},goalsSummary:Object,isVisitorLogEnabled:Boolean,segment:String,patternTranslations:{type:Object,required:!0},funnelFlow:{type:Object,required:!0},isNonGoalFunnel:{type:Boolean,required:!1,default:!1},userCanEditFunnels:{type:Boolean,required:!1,default:!1}},components:{ContentBlock:W["ContentBlock"]},directives:{ContentTable:W["ContentTable"]},methods:{openSegmentedVisitorLog(){ge.show("Funnel.getFunnelFlow",`funnels_name==${this.funnel.idfunnel}${this.segment?";"+this.segment:""}`,{})},openGoalReport(){W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Goals",subcategory:this.funnel.idgoal}))},editFunnel(){const e=this.funnel;e.idgoal&&"0"!==e.idgoal?W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Goals",subcategory:"Goals_ManageGoals",idGoal:e.idgoal,scrollToFunnel:1})):e.isSalesFunnel?W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Ecommerce",subcategory:"General_Overview",isFunnelEdit:!0,scrollToFunnel:1})):W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Funnels_Funnels",subcategory:"Funnels_ManageFunnels",idFunnel:e.idfunnel}))}}});ve.render=he;var fe=ve;const Fe={key:0,class:"reportFlow"},Ee=Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[Object(a["createElementVNode"])("th",{class:"funnelEntries"}),Object(a["createElementVNode"])("th",{class:"separator"}),Object(a["createElementVNode"])("th",{class:"funnelFlow"}),Object(a["createElementVNode"])("th",{class:"separator"}),Object(a["createElementVNode"])("th",{class:"funnelExits"})])],-1),Ne={key:1},ke=Object(a["createElementVNode"])("br",null,null,-1),Ve={key:0},ye={key:1};function Se(e,t,n,l,o,s){const i=Object(a["resolveComponent"])("EnrichedHeadline"),r=Object(a["resolveComponent"])("FunnelFlowRow"),c=Object(a["resolveComponent"])("ContentBlock");return Object(a["openBlock"])(),Object(a["createBlock"])(c,{class:"funnelsReport"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("h2",null,[Object(a["createVNode"])(i,{"feature-name":"Funnels","inline-help":e.translate("Funnels_GoalFunnelReportHelp")},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_GoalFunnelReport")),1)]),_:1},8,["inline-help"])]),e.funnelFlow.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("table",Fe,[Ee,Object(a["createElementVNode"])("tbody",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.funnelFlow,(t,n)=>(Object(a["openBlock"])(),Object(a["createBlock"])(r,{key:n,row:t,"is-last-row":n===e.funnelFlow.length-1,"id-site":e.idSite,funnel:e.funnel,"is-visitor-log-enabled":e.isVisitorLogEnabled,segment:e.segment},null,8,["row","is-last-row","id-site","funnel","is-visitor-log-enabled","segment"]))),128))])])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",Ne,[Object(a["createElementVNode"])("strong",null,Object(a["toDisplayString"])(e.translate("CoreHome_ThereIsNoDataForThisReport")),1),ke,e.hasBeenPurged?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Ve,Object(a["toDisplayString"])(e.translate("CoreHome_DataForThisReportHasBeenPurged",e.deleteReportsOlderThan)),1)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",ye,Object(a["toDisplayString"])(e.translate("Funnels_FunnelReportNotGeneratedYet")),1))]))]),_:1})}const _e={colspan:"5",class:"stepLabel"},we=["title"],Be=["title"],Ce=Object(a["createElementVNode"])("span",{class:"icon-visitor-profile",style:{visibility:"hidden"}},null,-1),Te={key:0,class:"icon-evolution",style:{visibility:"hidden"}},xe={key:1},Le={key:2},Me=["title"],De=Object(a["createElementVNode"])("span",{class:"icon-visitor-profile segmentVisitorsByFunnelStep"},null,-1),Ge=[De],Re=["title"],Ue=Object(a["createElementVNode"])("span",{class:"icon-evolution"},null,-1),He=[Ue],Ae={class:"funnelEntries"},qe=Object(a["createElementVNode"])("br",null,null,-1),Pe=Object(a["createElementVNode"])("td",{class:"separator"},[Object(a["createElementVNode"])("h4",{class:"entryArrow"},"→")],-1),Ie={class:"funnelFlow"},$e={key:0},ze=["title"],We=Object(a["createElementVNode"])("br",null,null,-1),Ye=Object(a["createElementVNode"])("span",{class:"proceededArrow"},"↓",-1),Xe=Object(a["createElementVNode"])("br",null,null,-1),Ke=["innerHTML"],Je=Object(a["createElementVNode"])("br",null,null,-1),Qe={key:1},Ze=["title"],et=Object(a["createElementVNode"])("br",null,null,-1),tt=Object(a["createElementVNode"])("span",{class:"proceededArrow"},"↓",-1),nt=Object(a["createElementVNode"])("br",null,null,-1),lt=Object(a["createElementVNode"])("br",null,null,-1),ot={class:"proceededRate"},at={class:"separator"},st={key:0,class:"exitArrow"},it={class:"funnelExits"},rt={key:0},ct=Object(a["createElementVNode"])("br",null,null,-1);function dt(e,t,n,l,o,s){const i=Object(a["resolveComponent"])("WidgetLoader");return Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],null,[Object(a["createElementVNode"])("tr",{class:Object(a["normalizeClass"])("step"+e.row.step_position)},[Object(a["createElementVNode"])("td",_e,[Object(a["createElementVNode"])("h3",{class:"stepName",title:e.row.step_definition},Object(a["toDisplayString"])(e.row.label),9,we),Object(a["createElementVNode"])("h3",{class:"stepMetric",title:e.row.step_nb_visits!==e.row.step_nb_visits_actual?e.translate("Funnels_HitsWereBackfilled",e.row.step_nb_visits_actual):e.translate("Funnels_HitsWereNotBackfilled")},[Ce,e.isLastRow?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Te)),1===e.row.step_nb_visits?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",xe,Object(a["toDisplayString"])(e.isLastRow?e.translate("Funnels_NbConversion",1):e.translate("General_OneVisit")),1)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Le,Object(a["toDisplayString"])(e.isLastRow?e.translate("Goals_Conversions",e.row.step_nb_visits):e.translate("General_NVisits",e.row.step_nb_visits)),1)),e.isVisitorLogEnabled?(Object(a["openBlock"])(),Object(a["createElementBlock"])("a",{key:3,href:"",title:e.translate("Funnels_SegmentVisitorsByThisFunnelStep"),class:"segmentVisitors",onClick:t[0]||(t[0]=Object(a["withModifiers"])(t=>e.openSegmentedVisitorLog(e.row.step_position),["prevent"]))},Ge,8,Me)):Object(a["createCommentVNode"])("",!0),e.isLastRow?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("a",{key:4,href:"",title:e.translate("General_RowEvolutionRowActionTooltipTitle"),class:"rowEvolutionByFunnelStep",onClick:t[1]||(t[1]=Object(a["withModifiers"])(t=>e.openRowEvolution(e.row.label),["prevent"]))},He,8,Re))],8,Be)])],2),Object(a["createElementVNode"])("tr",{class:Object(a["normalizeClass"])("step"+e.row.step_position)},[Object(a["createElementVNode"])("td",Ae,[Object(a["createElementVNode"])("h4",null,Object(a["toDisplayString"])(1===e.row.step_nb_entries?e.translate("Funnels_NbEntry",1):e.translate("Funnels_NbEntries",e.row.step_nb_entries)),1),qe,e.row.step_nb_entries?(Object(a["openBlock"])(),Object(a["createBlock"])(i,{key:0,class:"actionReportContainer","widget-params":{module:"Funnels",action:"getFunnelEntries",viewDataTable:"table",idSite:e.idSite,widget:1,disableLink:1,showtitle:0,idFunnel:e.funnel.idfunnel,step:e.row.step_position}},null,8,["widget-params"])):Object(a["createCommentVNode"])("",!0)]),Pe,Object(a["createElementVNode"])("td",Ie,[e.isLastRow?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",$e,[Object(a["createElementVNode"])("div",{title:e.translate("Funnels_XVisitorsConvertedFunnel",e.funnel.conversionRate),class:"progressOuter"},[e.funnel.conversionRate?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"progressInner",style:Object(a["normalizeStyle"])({width:e.funnel.conversionRate})},null,4)):Object(a["createCommentVNode"])("",!0)],8,ze),We,Ye,Xe,Object(a["createElementVNode"])("span",{class:"proceededRate",innerHTML:e.$sanitize(e.translate("Goals_ConversionRate",e.funnel.conversionRate+"<br />"))},null,8,Ke),Je,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_XoutOfYVisitsconverted",e.funnel.numConversions,e.funnel.numEntries)),1)])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Qe,[Object(a["createElementVNode"])("div",{title:e.row.step_proceeded_rate+" proceeded to the next step",class:"progressOuter"},[e.row.step_proceeded_rate?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"progressInner",style:Object(a["normalizeStyle"])({width:e.row.step_proceeded_rate})},null,4)):Object(a["createCommentVNode"])("",!0)],8,Ze),et,tt,nt,Object(a["createElementVNode"])("div",null,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_NbProceeded",e.row.step_nb_proceeded))+" ",1),lt,Object(a["createElementVNode"])("span",ot,Object(a["toDisplayString"])(e.row.step_proceeded_rate),1)])]))]),Object(a["createElementVNode"])("td",at,[e.isLastRow?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("h4",st,"→"))]),Object(a["createElementVNode"])("td",it,[e.isLastRow?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",rt,[Object(a["createElementVNode"])("h4",null,Object(a["toDisplayString"])(1===e.row.step_nb_exits||"1"===e.row.step_nb_exits?e.translate("Funnels_NbExit",1):e.translate("Funnels_NbExits",e.row.step_nb_exits)),1),ct,e.row.step_nb_exits?(Object(a["openBlock"])(),Object(a["createBlock"])(i,{key:0,class:"actionReportContainer","widget-params":{module:"Funnels",action:"getFunnelExits",viewDataTable:"table",idSite:e.idSite,widget:1,showtitle:0,disableLink:1,idFunnel:e.funnel.idfunnel,step:e.row.step_position}},null,8,["widget-params"])):Object(a["createCommentVNode"])("",!0)]))])],2)],64)}const{DataTable_RowActions_RowEvolution:ut,SegmentedVisitorLog:pt}=window;var bt=Object(a["defineComponent"])({props:{row:{type:Object,required:!0},funnel:{type:Object,required:!0},isLastRow:Boolean,isVisitorLogEnabled:Boolean,idSite:{type:[Number,String],required:!0},segment:String},components:{WidgetLoader:W["WidgetLoader"]},methods:{openSegmentedVisitorLog(e){const t=this.segment?";"+this.segment:"";pt.show("Funnel.getFunnelFlow",`funnels_name==${this.funnel.idfunnel};funnels_step_position==${e}${t}`,{})},openRowEvolution(e){(new ut).showRowEvolution("Funnels.getFunnelFlow",e,{idGoal:this.funnel.idgoal,idFunnel:this.funnel.idfunnel})}}});bt.render=dt;var mt=bt,Ot=Object(a["defineComponent"])({props:{funnel:{type:Object,required:!0},funnelFlow:{type:Array,required:!0},hasBeenPurged:Boolean,deleteReportsOlderThan:[Number,String],segment:String,idSite:{type:[Number,String],required:!0},isVisitorLogEnabled:Boolean},components:{ContentBlock:W["ContentBlock"],EnrichedHeadline:W["EnrichedHeadline"],FunnelFlowRow:mt}});Ot.render=Se;var jt=Ot;const ht={class:"manageSiteFunnels"},gt={key:0,class:"addNewNoEdit"},vt={class:"listFunnels"},ft={class:"contentHelp"},Ft={class:"first"},Et={key:0},Nt={key:0},kt={colspan:"4"},Vt=Object(a["createElementVNode"])("br",null,null,-1),yt=Object(a["createElementVNode"])("br",null,null,-1),St=Object(a["createElementVNode"])("br",null,null,-1),_t=["id"],wt={class:"first"},Bt=["title"],Ct={key:1},Tt={key:0,style:{"padding-top":"2px"}},xt=["onClick","title"],Lt=["onClick","title"],Mt={key:0,class:"tableActionBar"},Dt=Object(a["createElementVNode"])("span",{class:"icon-add"},null,-1),Gt={key:1},Rt=["innerHTML"],Ut={class:"ui-confirm",ref:"confirm"},Ht=["value"],At=["value"],qt={class:"ui-confirm",ref:"funnelIsLockedCannotBeSaved"},Pt=["value"];function It(e,t,n,l,o,s){var i;const r=Object(a["resolveComponent"])("ContentBlock"),c=Object(a["resolveComponent"])("ActivityIndicator"),d=Object(a["resolveComponent"])("Field"),u=Object(a["resolveComponent"])("ManageFunnel"),p=Object(a["resolveComponent"])("SaveButton"),b=Object(a["resolveDirective"])("content-table"),m=Object(a["resolveDirective"])("form");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",ht,[e.isAddNewView&&!e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",gt,[Object(a["createVNode"])(r,{"content-title":e.getEditFunnelHeader},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("p",null,Object(a["toDisplayString"])(e.translate("Funnels_AddNewUserUnableToEdit")),1)]),_:1},8,["content-title"])])):Object(a["createCommentVNode"])("",!0),Object(a["withDirectives"])(Object(a["createElementVNode"])("div",vt,[Object(a["createVNode"])(r,{"content-title":e.translate("Funnels_ManageFunnels")},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(c,{loading:e.isLoading},null,8,["loading"]),Object(a["createElementVNode"])("div",ft,Object(a["toDisplayString"])(e.translate("Funnels_Introduction")),1),Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createElementBlock"])("table",null,[Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[Object(a["createElementVNode"])("th",Ft,Object(a["toDisplayString"])(e.translate("General_Id")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Funnels_FunnelName")),1),Object(a["createElementVNode"])("th",null,Object(a["toDisplayString"])(e.translate("Goals_GoalConversion")),1),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("th",Et,Object(a["toDisplayString"])(e.translate("General_Actions")),1)):Object(a["createCommentVNode"])("",!0)])]),Object(a["createElementVNode"])("tbody",null,[Object.keys(e.funnels||{}).length?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",Nt,[Object(a["createElementVNode"])("td",kt,[Vt,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_ThereIsNoFunnelToManage",e.siteName))+" ",1),yt,St])])),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.funnels||[],t=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("tr",{id:t.idfunnel,key:t.idfunnel},[Object(a["createElementVNode"])("td",wt,Object(a["toDisplayString"])(t.idfunnel),1),Object(a["createElementVNode"])("td",null,Object(a["toDisplayString"])(t.name),1),Object(a["createElementVNode"])("td",null,[t.idgoal&&0!==Number(t.idgoal)||t.isSalesFunnel?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",{key:0,class:"icon-ok system-success",title:e.$sanitize(e.translate("Funnels_GoalCheckHover",t.name))},null,8,Bt)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",Ct,"-"))]),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("td",Tt,[e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("button",{key:0,onClick:n=>e.editFunnel(t.idfunnel),class:"table-action icon-edit",title:e.translate("General_Edit")},null,8,xt)):Object(a["createCommentVNode"])("",!0),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("button",{key:1,onClick:n=>e.deleteFunnel(t.idfunnel),class:"table-action icon-delete",title:e.translate("General_Delete")},null,8,Lt)):Object(a["createCommentVNode"])("",!0)])):Object(a["createCommentVNode"])("",!0)],8,_t))),128))])])),[[b]]),e.userCanEditFunnels?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Mt,[Object(a["createElementVNode"])("button",{id:"addFunnel",onClick:t[0]||(t[0]=t=>e.createFunnel())},[Dt,Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.translate("Funnels_AddNewFunnel")),1)])])):Object(a["createCommentVNode"])("",!0)]),_:1},8,["content-title"])],512),[[a["vShow"],e.showFunnelList&&!e.isAddNewView]]),e.userCanEditFunnels?Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Gt,[Object(a["createVNode"])(r,{"content-title":e.getEditFunnelHeader},{default:Object(a["withCtx"])(()=>[Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createElementBlock"])("div",null,[Object(a["createElementVNode"])("div",null,[Object(a["createVNode"])(d,{uicontrol:"text",name:"funnelName",modelValue:e.funnelName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.funnelName=t),maxlength:50,title:e.translate("Funnels_FunnelName"),"inline-help":e.translate("Funnels_FunnelNameHelp")},null,8,["modelValue","title","inline-help"])]),Object(a["createVNode"])(u,{"is-non-goal-funnel":!0,"show-goal":0,"is-hide-enable":!0,goals:e.goals},null,8,["goals"]),Object(a["createVNode"])(p,{saving:e.isLoading,onConfirm:t[2]||(t[2]=t=>e.save()),value:e.getSubmitText,class:"saveBtn"},null,8,["saving","value"]),e.isAddNewView?Object(a["createCommentVNode"])("",!0):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"entityCancel",onClick:t[3]||(t[3]=t=>e.showListOfFunnels()),innerHTML:e.$sanitize(e.cancelText)},null,8,Rt))])),[[m]])]),_:1},8,["content-title"]),Object(a["createElementVNode"])("div",Ut,[Object(a["createElementVNode"])("h2",null,Object(a["toDisplayString"])(e.translate("Funnels_DeleteFunnelConfirm",`"${null===(i=e.funnelToDelete)||void 0===i?void 0:i.name}"`)),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Ht),Object(a["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,At)],512),Object(a["createElementVNode"])("div",qt,[Object(a["createElementVNode"])("h3",null,Object(a["toDisplayString"])(e.translate("Funnels_FunnelIsLockedCannotBeSaved")),1),Object(a["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Ok")},null,8,Pt)],512)],512)),[[a["vShow"],e.showEditFunnel||e.isAddNewView]]):Object(a["createCommentVNode"])("",!0)])}var $t=Object(a["defineComponent"])({props:{userCanEditFunnels:Boolean,isAddNewView:{type:Boolean,default:!1},siteId:{type:Number,required:!0},siteName:{type:String,required:!0},funnels:{type:Object,required:!0},funnelId:{type:Number,required:!1,default:0},goals:{type:Array,required:!0}},data(){return{showEditFunnel:!1,showFunnelList:!0,isLoading:!1,idFunnel:0,funnelName:"",funnelToDelete:null}},components:{Field:Y["Field"],SaveButton:Y["SaveButton"],ContentBlock:W["ContentBlock"],ActivityIndicator:W["ActivityIndicator"],ManageFunnel:J},directives:{ContentTable:W["ContentTable"],Form:Y["Form"]},methods:{scrollToTop(){setTimeout(()=>{W["Matomo"].helper.lazyScrollTo(".pageWrap",200)})},editFunnel(e){const t=this.funnels.find(t=>Number(t.idfunnel)===Number(e));t.idgoal&&"0"!==t.idgoal&&W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Goals",subcategory:"Goals_ManageGoals",idGoal:t.idgoal,scrollToFunnel:1})),t.isSalesFunnel&&W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{category:"Goals_Ecommerce",subcategory:"General_Overview",isFunnelEdit:!0,scrollToFunnel:1})),W["Matomo"].postEvent("Funnels.initFunnelForm",this.siteId,e),this.showFunnelList=!1,this.showEditFunnel=!0,this.idFunnel=e,this.funnelName=t.name},deleteFunnel(e){this.funnelToDelete=this.funnels.find(t=>t.idfunnel===e),W["Matomo"].helper.modalConfirm(this.$refs.confirm,{yes:()=>{this.isLoading=!0,W["AjaxHelper"].fetch({idSite:this.siteId,idFunnel:e,method:"Funnels.deleteNonGoalFunnel"}).then(()=>{window.location.reload()}).finally(()=>{this.isLoading=!1})}})},createFunnel(){this.idFunnel=0,this.funnelName="",W["Matomo"].postEvent("Funnels.resetForm",{}),this.showFunnelList=!1,this.showEditFunnel=!0},showListOfFunnels(){this.showFunnelList=!0,this.showEditFunnel=!1,this.scrollToTop()},save(){const e={method:"Funnels.saveNonGoalFunnel",idFunnel:this.idFunnel,funnelName:this.funnelName},t={};W["Matomo"].postEvent("Funnels.beforeUpdateFunnel",{parameters:e,options:t}),e&&e.isLocked&&this.$refs.funnelIsLockedCannotBeSaved?W["Matomo"].helper.modalConfirm(this.$refs.funnelIsLockedCannotBeSaved,{}):e.cancelRequest||W["AjaxHelper"].fetch(e,t).then(()=>{const e=W["MatomoUrl"].parsed.value.subcategory;"Funnels_AddNewFunnel"===e&&W["Matomo"].helper.isReportingPage()?W["ReportingMenuStore"].reloadMenuItems().then(()=>{W["MatomoUrl"].updateHash(Object.assign(Object.assign({},W["MatomoUrl"].hashParsed.value),{},{subcategory:"Funnels_ManageFunnels"})),this.isLoading=!1}):window.location.reload()}).catch(()=>{this.scrollToTop(),this.isLoading=!1})}},computed:{getEditFunnelHeader(){return 0===this.idFunnel?Object(W["translate"])("Funnels_AddNewFunnel"):Object(W["translate"])("Funnels_UpdateFunnel")},getSubmitText(){return 0===this.idFunnel?Object(W["translate"])("Funnels_AddFunnel"):Object(W["translate"])("Funnels_UpdateFunnel")},cancelText(){return Object(W["translate"])("General_OrCancel","<a class='entityCancelLink'>","</a>")}},mounted(){this.funnelId>0&&Object(a["nextTick"])(()=>{this.editFunnel(this.funnelId)})}});$t.render=It;var zt=$t;const Wt={class:"funnelReport"},Yt={class:"funnelReportHeader"},Xt={key:0,class:"legend"},Kt=["title"],Jt=Object(a["createElementVNode"])("div",{class:"colorBoxSplit"},null,-1),Qt={class:"text"},Zt={class:"title"},en={key:0,class:"subtitle"},tn={key:1,class:"items"},nn={key:0,class:"item"},ln=Object(a["createElementVNode"])("div",{class:"colorBoxProceeded"},null,-1),on={class:"text"},an={class:"title"},sn={key:1,class:"item"},rn=Object(a["createElementVNode"])("div",{class:"colorBoxEntries"},null,-1),cn={class:"text"},dn={class:"title"},un={key:2,class:"item"},pn=Object(a["createElementVNode"])("div",{class:"colorBoxSkipped"},null,-1),bn={class:"text"},mn={class:"title"},On={key:3,class:"item"},jn=Object(a["createElementVNode"])("div",{class:"colorBoxExits"},null,-1),hn={class:"text"},gn={class:"title"},vn={key:0,id:"funnelConversionTable"},fn={class:"stepTitle"},Fn={class:"stepLabel"},En={class:"cellLabel"},Nn={class:"metricCount"},kn={class:"barsContainer"},Vn={class:"barStep"},yn=["onMouseenter","onMousemove","onMouseleave"],Sn=["onMouseenter","onMousemove","onMouseleave"],_n=["onMouseenter","onMousemove","onMouseleave"],wn=["onMouseenter","onMousemove","onMouseleave"],Bn={class:"cellLabel"},Cn={class:"metricCount"},Tn={class:"metricRate"},xn={key:1},Ln=Object(a["createElementVNode"])("br",null,null,-1);function Mn(e,t,n,l,o,s){const i=Object(a["resolveComponent"])("EnrichedHeadline"),r=Object(a["resolveComponent"])("ContentBlock"),c=Object(a["resolveComponent"])("Tooltip");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Wt,[Object(a["createVNode"])(r,null,{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",Yt,[Object(a["createElementVNode"])("h2",null,[Object(a["createVNode"])(i,{"feature-name":"Funnels","inline-help":e.getFunnelReportHelpText},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.translate("Funnels_FunnelReport")),1)]),_:1},8,["inline-help"])]),e.getFunnelSteps.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",Xt,[e.metadata.has_multiple_valid_segments?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"items",style:Object(a["normalizeStyle"])(e.metadata.has_period_comparison?`grid-template-columns: repeat(${e.columnsPerRow}, auto);`:"grid-template-columns: repeat(3, auto);")},[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.metadata.segments,(t,n)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{class:"item",key:n,title:e.parseLegendText(n).hover},[Jt,Object(a["createElementVNode"])("div",Qt,[Object(a["createElementVNode"])("span",Zt,Object(a["toDisplayString"])(e.parseLegendText(n).title),1),e.metadata.has_period_comparison?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",en,Object(a["toDisplayString"])(e.parseLegendText(n).subtitle),1)):Object(a["createCommentVNode"])("",!0)])],8,Kt))),128))],4)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",tn,[e.metadata.has_proceeded?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",nn,[ln,Object(a["createElementVNode"])("div",on,[Object(a["createElementVNode"])("span",an,Object(a["toDisplayString"])(e.translate("Funnels_Progressions")),1)])])):Object(a["createCommentVNode"])("",!0),e.metadata.has_entries?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",sn,[rn,Object(a["createElementVNode"])("div",cn,[Object(a["createElementVNode"])("span",dn,Object(a["toDisplayString"])(e.translate("Funnels_Entries")),1)])])):Object(a["createCommentVNode"])("",!0),e.metadata.has_skipped?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",un,[pn,Object(a["createElementVNode"])("div",bn,[Object(a["createElementVNode"])("span",mn,Object(a["toDisplayString"])(e.translate("Funnels_Skips")),1)])])):Object(a["createCommentVNode"])("",!0),e.metadata.has_exits?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",On,[jn,Object(a["createElementVNode"])("div",hn,[Object(a["createElementVNode"])("span",gn,Object(a["toDisplayString"])(e.translate("Funnels_DropOff")),1)])])):Object(a["createCommentVNode"])("",!0)]))])):Object(a["createCommentVNode"])("",!0)]),e.getFunnelSteps.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("table",vn,[Object(a["createElementVNode"])("thead",null,[Object(a["createElementVNode"])("tr",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.metadata.steps,(t,n)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("th",{key:t},[Object(a["createElementVNode"])("div",fn,Object(a["toDisplayString"])(e.translate("Funnels_Step"))+" "+Object(a["toDisplayString"])(n+1),1),Object(a["createElementVNode"])("div",Fn,Object(a["toDisplayString"])(t),1)]))),128))])]),Object(a["createElementVNode"])("tbody",null,[Object(a["createElementVNode"])("tr",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.getFunnelSteps,(t,n)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("td",{key:n},[Object(a["createElementVNode"])("div",En,Object(a["toDisplayString"])(e.translate("General_ColumnNbVisits")),1),Object(a["createElementVNode"])("div",Nn,Object(a["toDisplayString"])(e.formatAbbr(e.getFirstSegmentStep(n).step_nb_visits)),1),Object(a["createElementVNode"])("div",kn,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(t,(t,l)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:l,class:"barStepContainer"},[Object(a["createElementVNode"])("div",Vn,[Object(a["createElementVNode"])("div",{class:"barProceeded",style:Object(a["normalizeStyle"])({height:e.getBarHeight("proceeded",n,t)}),onMouseenter:o=>e.handleTooltip(o,l,n,t,"proceeded","show"),onMousemove:o=>e.handleTooltip(o,l,n,t,"proceeded","move"),onMouseleave:o=>e.handleTooltip(o,l,n,t,"proceeded","hide")},null,44,yn),Object(a["createElementVNode"])("div",{class:"barEntries",style:Object(a["normalizeStyle"])("0%"===e.getBarHeight("entries",n,t)?{display:"none"}:{height:e.getBarHeight("entries",n,t)}),onMouseenter:o=>e.handleTooltip(o,l,n,t,"entries","show"),onMousemove:o=>e.handleTooltip(o,l,n,t,"entries","move"),onMouseleave:o=>e.handleTooltip(o,l,n,t,"entries","hide")},null,44,Sn),Object(a["createElementVNode"])("div",{class:"barSkipped",style:Object(a["normalizeStyle"])("0%"===e.getBarHeight("skipped",n,t)?{display:"none"}:{height:e.getBarHeight("skipped",n,t)}),onMouseenter:o=>e.handleTooltip(o,l,n,t,"skipped","show"),onMousemove:o=>e.handleTooltip(o,l,n,t,"skipped","move"),onMouseleave:o=>e.handleTooltip(o,l,n,t,"skipped","hide")},null,44,_n),Object(a["createElementVNode"])("div",{class:"barExits",style:Object(a["normalizeStyle"])("0%"===e.getBarHeight("exits",n,t)?{display:"none"}:{height:e.getBarHeight("exits",n,t)}),onMouseenter:o=>e.handleTooltip(o,l,n,t,"exits","show"),onMousemove:o=>e.handleTooltip(o,l,n,t,"exits","move"),onMouseleave:o=>e.handleTooltip(o,l,n,t,"exits","hide")},null,44,wn)])]))),128))])]))),128))]),Object(a["createElementVNode"])("tr",null,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.getFunnelSteps,(t,n)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("td",{key:n},[Object(a["createElementVNode"])("div",Bn,Object(a["toDisplayString"])(e.getBottomLabel(e.getFunnelSteps.length===n+1)),1),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(e.getMetricValueClasses(e.getFunnelSteps.length===n+1))},[Object(a["createElementVNode"])("span",Cn,Object(a["toDisplayString"])(e.formatAbbr(e.getBottomMetric(n,e.getFirstSegmentStep(n)))),1),Object(a["createElementVNode"])("span",Tn," ("+Object(a["toDisplayString"])(e.getBottomRate(n,e.getFirstSegmentStep(n)))+") ",1)],2)]))),128))])])])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("p",xn,[Object(a["createElementVNode"])("strong",null,Object(a["toDisplayString"])(e.translate("CoreHome_ThereIsNoDataForThisReport")),1),Ln,Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(e.translate("Funnels_FunnelReportNotGeneratedYet")),1)]))]),_:1}),Object(a["createVNode"])(c,{ref:"tooltip",title:e.tooltipTitle,subtitle:e.tooltipSubtitle,exits:e.tooltipExits,skipped:e.tooltipSkipped,entries:e.tooltipEntries,proceeded:e.tooltipProceeded,type:e.tooltipType},null,8,["title","subtitle","exits","skipped","entries","proceeded","type"])])}const Dn={class:"tooltip-item title"},Gn={class:"tooltip-item subtitle"},Rn={class:"tooltip-label"},Un={class:"tooltip-value"},Hn={class:"tooltip-label"},An={class:"tooltip-value"},qn={class:"tooltip-label"},Pn={class:"tooltip-value"},In={class:"tooltip-label"},$n={class:"tooltip-value"};function zn(e,t,n,l,o,s){return Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{ref:"tooltipRef",class:"tooltip tooltip-funnel",style:Object(a["normalizeStyle"])(e.tooltipStyle)},[Object(a["createElementVNode"])("div",Dn,Object(a["toDisplayString"])(e.title),1),Object(a["createElementVNode"])("div",Gn,Object(a["toDisplayString"])(e.subtitle),1),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["tooltip-item",{selected:"exits"===e.type}])},[Object(a["createElementVNode"])("span",Rn,Object(a["toDisplayString"])(e.translate("Funnels_DropOff")),1),Object(a["createElementVNode"])("span",Un,Object(a["toDisplayString"])(e.formatNumber(e.exits)),1)],2),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["tooltip-item",{selected:"skipped"===e.type}])},[Object(a["createElementVNode"])("span",Hn,Object(a["toDisplayString"])(e.translate("Funnels_Skips")),1),Object(a["createElementVNode"])("span",An,Object(a["toDisplayString"])(e.formatNumber(e.skipped)),1)],2),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["tooltip-item",{selected:"entries"===e.type}])},[Object(a["createElementVNode"])("span",qn,Object(a["toDisplayString"])(e.translate("Funnels_Entries")),1),Object(a["createElementVNode"])("span",Pn,Object(a["toDisplayString"])(e.formatNumber(e.entries)),1)],2),Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["tooltip-item",{selected:"proceeded"===e.type}])},[Object(a["createElementVNode"])("span",In,Object(a["toDisplayString"])(e.translate("Funnels_Progressions")),1),Object(a["createElementVNode"])("span",$n,Object(a["toDisplayString"])(e.formatNumber(e.proceeded)),1)],2)],4)),[[a["vShow"],e.visible]])}var Wn=n("6ec9"),Yn=Object(a["defineComponent"])({props:{title:{type:String,required:!0},subtitle:{type:String,required:!0},exits:{type:Number,required:!0},skipped:{type:Number,required:!0},entries:{type:Number,required:!0},proceeded:{type:Number,required:!0},type:{type:String,required:!0}},setup(){const e=Object(a["reactive"])({visible:!1,position:{top:0,left:0}}),t=Object(a["ref"])(null),n=Object(a["computed"])(()=>({top:e.position.top+"px",left:e.position.left+"px",position:"absolute",zIndex:1e3}));function l(n){const l=window.scrollY||document.documentElement.scrollTop,o=window.scrollX||document.documentElement.scrollLeft;e.position.top=n.clientY+l+10,e.position.left=n.clientX+o+10,e.visible=!0,Object(a["nextTick"])(()=>{const a=t.value;if(a){const{innerWidth:t,innerHeight:s}=window,i=a.getBoundingClientRect();i.right>t&&(e.position.left=n.clientX+o-i.width-10),i.bottom>s&&(e.position.top=n.clientY+l-i.height-10);const r=a.getBoundingClientRect();r.left<0&&(e.position.left=o+10),r.top<0&&(e.position.top=l+10)}})}function o(){e.visible=!1}return Object.assign(Object.assign({},Object(a["toRefs"])(e)),{},{tooltipRef:t,show:l,hide:o,tooltipStyle:n,translate:W["translate"],formatNumber:Wn["formatNumber"]})}});Yn.render=zn;var Xn=Yn,Kn=Object(a["defineComponent"])({props:{metadata:{type:Object,required:!0},firstSegmentFlow:{type:Array,required:!0},funnelFlow:{type:Array,required:!0},isClosedFunnel:{type:Boolean,default:!1}},components:{EnrichedHeadline:W["EnrichedHeadline"],ContentBlock:W["ContentBlock"],Tooltip:Xn},setup(){const e=Object(a["ref"])(null);return{tooltip:e,formatAbbr:Wn["formatAbbr"]}},mounted(){0},data(){return{tooltipTitle:"",tooltipSubtitle:"",tooltipExits:0,tooltipSkipped:0,tooltipEntries:0,tooltipProceeded:0,tooltipType:""}},methods:{getFirstSegmentStep(e){return this.firstSegmentFlow[e]||{}},translateNumericPlaceholder(e,t){return Object(W["translate"])(e,t||0)},getBarHeight(e,t,n){if(null===n)return"0%";const l={empty:n.bar_height_empty,exits:n.bar_height_exits,skipped:n.bar_height_skipped,entries:0===t?0:n.bar_height_entries,proceeded:0===t?n.bar_height_entries:n.bar_height_proceeded};return(l[e]||0)+"%"},setTooltipData(e,t,n,l){const{title:o,period:a}=this.parseSegmentKey(e);this.tooltipTitle=o,this.tooltipSubtitle=a,this.tooltipExits=n.step_nb_previous_exits||0,this.tooltipSkipped=n.step_nb_skipped||0,this.tooltipEntries=n.step_nb_entries||0,this.tooltipProceeded=n.step_nb_previous_proceeded||0,this.tooltipType=0===t&&"proceeded"===l?"entries":l},parseLegendText(e){const{title:t,period:n}=this.parseSegmentKey(e);return{title:t,subtitle:n,hover:`${t} (${n})`}},parseSegmentKey(e){const t=String(e),n=t.split("~|~"),l=n[0],o=n[1];return{title:l,period:o}},getBottomLabel(e){return e?Object(W["translate"])("Funnels_FunnelConversion"):Object(W["translate"])("Funnels_Exits")},getBottomMetric(e,t){return this.getFunnelSteps.length===e+1?t.step_nb_visits:t.step_nb_exits},getBottomRate(e,t){return this.getFunnelSteps.length===e+1?t.conversion_rate:t.step_rate_exits},getMetricValueClasses(e){let t="metricValues";return e&&(t+=" conversionMetrics"),t},handleTooltip(e,t,n,l,o,a){this.tooltip&&("show"===a?(this.setTooltipData(t,n,l,o),this.tooltip.show(e)):"move"===a?this.tooltip.show(e):this.tooltip.hide())}},computed:{getFunnelSteps(){return this.funnelFlow},getFunnelReportHelpText(){const e=Object(W["translate"])("Funnels_FunnelReportHelp");let t=Object(W["translate"])("Funnels_FunnelReportHelpOpenFunnel"),n=`${e} ${t}`;return this.isClosedFunnel&&(t=Object(W["translate"])("Funnels_FunnelReportHelpClosedFunnel"),n=`${e} ${t}`),n},columnsPerRow(){const e=Object.keys(this.metadata.segments).length;return Math.ceil(e/2)}}});Kn.render=Mn;var Jn=Kn;
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */}})}));
//# sourceMappingURL=Funnels.umd.min.js.map